MODULES_DIR=$(FILESYSTEM_ROOT)/lib/modules/3.9.0-xilinx/
PATH:=$(PATH):$(GNU_TOOLS_BIN)

# ThinkLCDML
thinklcdml-git-repo="git@github.com:fakedrake/ThinkLCDML"
GIT_PROJECTS += thinklcdml
TLCDML_MODULE=$(MODULES_DIR)/thinklcdml.ko

thinklcdml-build: $(TLCDML_MODULE)

$(TLCDML_MODULE): linux-build thinklcdml
	cd $(SOURCES_DIR)/thinklcdml-git && \
	./builder.sh --root $(SOURCES_DIR)/../
	cp $(SOURCES_DIR)/thinklcdml-git/thinklcdml.ko $(TLCDML_MODULE)
	cat $(MODULES_DIR)/modules.dep.bb | grep thinklcdml.ko || echo "thinklcdml.ko" >> $(MODULES_DIR)/modules.dep.bb

thinklcdml-clean:
	cd $(SOURCES_DIR)/thinklcdml-git && make clean

# Think2D
think2d-git-repo="git@github.com:fakedrake/Think2D"
GIT_PROJECTS += think2d
T2D_MODULE=$(MODULES_DIR)/think2d.ko

think2d-build: $(T2D_MODULE)

$(T2D_MODULE): linux-build thinklcdml-build think2d
	cd $(SOURCES_DIR)/think2d-git && \
	./builder.sh --root $(SOURCES_DIR)/../
	cp $(SOURCES_DIR)/think2d-git/think2d.ko $(T2D_MODULE)
	cat $(MODULES_DIR)/modules.dep.bb | grep think2d.ko || echo "thinkl2d.ko" >> $(MODULES_DIR)/modules.dep.bb

think2d-clean:
	cd $(SOURCES_DIR)/think2d-git && make clean

ioctler-git-repo="git@github.com:fakedrake/ioctler"
GIT_PROJECTS += ioctler

ioctler-build: ioctler
	cd $(SOURCES_DIR)/ioctler-git; \
	make CC=$(CROSS_COMPILE)gcc DEBUG=y &&	\
	make install FS_ROOT=$(FILESYSTEM_ROOT)

ioctler-clean:
	cd $(SOURCES_DIR)/ioctler-git; \
	make clean; \
	make uninstall FS_ROOT=$(FILESYSTEM_ROOT)

tsi-drivers: think2d-build thinklcdml-build ioctler-build
tsi-drivers-clear: think2d-clean thinklcdml-clean ioctler-clean
